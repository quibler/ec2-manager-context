<?xml version="1.0" encoding="utf-8" ?>
<templates id="template" xml:space="preserve">
    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <!-- Add Brand QR Code at the bottom of the receipt -->
        <xpath expr="//div[hasclass('pos-receipt')]" position="inside">

            <!-- Debug section - ALWAYS show this to see what's happening -->
            <div class="pos-receipt-debug" style="margin-top: 20px; padding: 10px; border: 1px solid #red; font-size: 10px;">
                <strong>DEBUG INFO:</strong><br/>
                QR Code Object Exists: <t t-esc="props.data.brand_qr_code ? 'YES' : 'NO'"/><br/>
                <t t-if="props.data.brand_qr_code">
                    Enabled: <t t-esc="props.data.brand_qr_code.enabled ? 'YES' : 'NO'"/><br/>
                    Image URL: <t t-esc="props.data.brand_qr_code.image ? 'EXISTS' : 'NULL'"/><br/>
                    Label: <t t-esc="props.data.brand_qr_code.label"/><br/>
                    Config Exists: <t t-esc="props.data.brand_qr_code.debug_config_exists ? 'YES' : 'NO'"/><br/>
                    Enabled Setting: <t t-esc="props.data.brand_qr_code.debug_enabled_setting ? 'YES' : 'NO'"/><br/>
                    Image Setting: <t t-esc="props.data.brand_qr_code.debug_image_exists ? 'YES' : 'NO'"/><br/>
                </t>
            </div>

            <!-- Actual QR Code section -->
            <div t-if="props.data.brand_qr_code and props.data.brand_qr_code.enabled"
                 class="pos-receipt-brand-qr text-center"
                 style="margin-top: 20px; padding: 10px; border-top: 1px dashed #000;">

                <!-- QR Code Label -->
                <div class="pos-receipt-brand-qr-label"
                     style="font-size: 12px; font-weight: bold; margin-bottom: 10px;">
                    <t t-esc="props.data.brand_qr_code.label"/>
                </div>

                <!-- QR Code Image with error handling -->
                <div style="margin-bottom: 10px;">
                    <img t-att-src="props.data.brand_qr_code.image"
                         alt="Brand QR Code"
                         style="width: 120px; height: 120px; display: block; margin: 0 auto;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"/>
                    <!-- Fallback text if image fails to load -->
                    <div style="display: none; font-size: 10px; color: #666;">
                        QR Code not available
                    </div>
                </div>
            </div>

            <!-- Test section - ALWAYS show this regardless of conditions -->
            <div class="pos-receipt-test" style="margin-top: 10px; padding: 5px; background: #f0f0f0; font-size: 10px;">
                <strong>TEST SECTION (Always Visible)</strong><br/>
                This should always appear on the receipt.
            </div>
        </xpath>
    </t>
</templates>