<?xml version="1.0" encoding="utf-8" ?>
<!-- OrderReceipt Template - Compact Thermal Printer Version -->
<templates id="template" xml:space="preserve">
    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">

        <!-- Add sales person and global discount to receipt data -->
        <xpath expr="//t[@t-set='receipt']" position="after">
            <!-- Add sales person to receipt data -->
            <t t-if="props.data.sales_person_id">
                <t t-set="receipt.sales_person"
                   t-value="props.data.employees?.find(emp => emp.id === props.data.sales_person_id)?.name"/>
            </t>

            <!-- Add global discount data -->
            <t t-if="props.data.global_discount_amount and props.data.global_discount_amount > 0">
                <t t-set="receipt.global_discount_amount" t-value="props.data.global_discount_amount"/>
                <t t-set="receipt.formatted_global_discount_amount"
                   t-value="env.utils.formatCurrency(props.data.global_discount_amount)"/>
                <t t-set="receipt.global_discount_type" t-value="'amount'"/>
            </t>
            <t t-elif="props.data.global_discount_percentage and props.data.global_discount_percentage > 0">
                <t t-set="receipt.global_discount_percentage" t-value="props.data.global_discount_percentage"/>
                <t t-set="receipt.global_discount_type" t-value="'percentage'"/>
            </t>
        </xpath>

        <!-- Replace the entire ReceiptHeader with compact version -->
        <xpath expr="//ReceiptHeader" position="replace">
            <!-- Compact header for thermal printer -->
            <div class="receipt-header-compact" style="text-align: center; font-size: 12px; line-height: 1.2;">
                <!-- Company Logo - smaller -->
                <img t-attf-src="/web/image?model=res.company&amp;id={{props.data.headerData.company.id}}&amp;field=logo"
                     alt="Logo" style="max-width: 120px; max-height: 40px; margin: 2px auto;"/>

                <!-- Company Name -->
                <div style="font-weight: bold; font-size: 14px; margin: 2px 0;">
                    <t t-esc="props.data.headerData.company.name"/>
                </div>

                <!-- Address - compact format -->
                <div style="font-size: 10px; line-height: 1.1;">
                    <div t-if="props.data.headerData.company.street or props.data.headerData.company.street2">
                        <span t-if="props.data.headerData.company.street" t-esc="props.data.headerData.company.street"/>
                        <span t-if="props.data.headerData.company.street2">, <t t-esc="props.data.headerData.company.street2"/></span>
                    </div>
                    <div t-if="props.data.headerData.company.city or props.data.headerData.company.zip">
                        <span t-if="props.data.headerData.company.city" t-esc="props.data.headerData.company.city"/>
                        <span t-if="props.data.headerData.company.zip"> <t t-esc="props.data.headerData.company.zip"/></span>
                    </div>
                    <!-- Phone - single line -->
                    <div t-if="props.data.headerData.company.phone" t-esc="props.data.headerData.company.phone"/>
                </div>

                <!-- Order info - compact -->
                <div style="margin: 5px 0; border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 2px 0;">
                    <div style="font-size: 11px;">
                        <span t-if="props.data.pos_config_name">Shop: <t t-esc="props.data.pos_config_name"/></span>
                    </div>
                    <div t-if="props.data.headerData.trackingNumber" style="font-weight: bold; font-size: 12px;">
                        #<t t-esc="props.data.headerData.trackingNumber"/>
                    </div>
                </div>

                <!-- Sales Person - compact -->
                <div t-if="receipt.sales_person" style="font-size: 10px; margin: 2px 0;">
                    Sales Person: <t t-esc="receipt.sales_person"/>
                </div>
            </div>
        </xpath>

        <!-- Replace OrderWidget with ultra-compact version -->
        <xpath expr="//OrderWidget" position="replace">
            <!-- Compact Order Lines like left receipt -->
            <div class="compact-order-lines" style="font-size: 10px; line-height: 1.2;">

                <!-- Table header -->
                <div style="border-bottom: 1px dashed #000; padding: 1px 0; margin: 2px 0;">
                    <table style="width: 100%; font-size: 9px;">
                        <tr>
                            <td style="text-align: left;">Item</td>
                            <td style="text-align: center; width: 15%;">Qty</td>
                            <td style="text-align: right; width: 20%;">Rate</td>
                            <td style="text-align: right; width: 20%;">Amount</td>
                        </tr>
                    </table>
                </div>

                <!-- Order Lines - compact table format -->
                <div t-foreach="props.data.orderlines" t-as="line" t-key="line.id">
                    <table style="width: 100%; font-size: 9px; margin: 1px 0;">
                        <tr>
                            <td style="text-align: left; padding-right: 5px;">
                                <t t-esc="line.productName"/>
                                <div t-if="line.discount > 0" style="font-size: 8px;">
                                    Disc: <t t-esc="line.discount"/>%
                                </div>
                            </td>
                            <td style="text-align: center; width: 15%;" t-esc="line.qty"/>
                            <td style="text-align: right; width: 20%;" t-esc="line.unitPrice"/>
                            <td style="text-align: right; width: 20%;" t-esc="line.price"/>
                        </tr>
                    </table>
                    <!-- Customer note if exists -->
                    <div t-if="line.customerNote" style="font-size: 8px; margin-left: 5px; font-style: italic;">
                        Note: <t t-esc="line.customerNote"/>
                    </div>
                </div>

                <!-- Separator before totals -->
                <div style="border-top: 1px dashed #000; margin: 3px 0;"></div>

                <!-- Global Discount - compact format -->
                <div t-if="receipt.global_discount_amount or receipt.global_discount_percentage">
                    <table style="width: 100%; font-size: 9px;">
                        <tr>
                            <td style="text-align: left;">
                                Global Discount
                                <span t-if="receipt.global_discount_type === 'amount'">(Amount)</span>
                                <span t-elif="receipt.global_discount_type === 'percentage'">(Percent)</span>
                            </td>
                            <td style="text-align: right;">
                                <span t-if="receipt.global_discount_type === 'amount'"
                                      t-esc="receipt.formatted_global_discount_amount"/>
                                <span t-elif="receipt.global_discount_type === 'percentage'">
                                    <t t-esc="receipt.global_discount_percentage"/>%
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- General Note - compact -->
                <div t-if="props.data.generalNote" style="font-size: 8px; margin: 3px 0; font-style: italic; border-top: 1px dashed #000; padding-top: 2px;">
                    <strong>Note:</strong> <t t-esc="props.data.generalNote"/>
                </div>
            </div>
        </xpath>

        <!-- Remove "Powered by Odoo" -->
        <xpath expr="//div[@class='pos-receipt-order-data']//p[text()='Powered by Odoo']" position="replace">
            <!-- Remove completely -->
        </xpath>

        <!-- Compact QR code footer -->
        <xpath expr="//div[@class='after-footer']" position="after">
            <div style="text-align: center; margin: 5px 0;">
                <img src="/custom_pos/static/src/img/brand_qr_code.png"
                     alt="QR Code"
                     style="width: 60px; height: 60px;"/>
                <div style="font-size: 8px; margin-top: 2px;">
                    Scan to visit our brand page
                </div>
            </div>
        </xpath>

    </t>
</templates>